description: Perform a security scan using Aikido Security's CI API client

parameters:
  aikido_api_key:
    type: string
    description: Key generated by Aikido Security. Can be generated at https://app.aikido.dev/settings/integrations/continuous-integration
  repository_id:
    type: string
    description: Repository id where the current pipeline is running
  base_commit_sha:
    type: string
    description: Commit sha where the current branch is based on
  head_commit_sha:
    type: string
    description: Commit sha of the current branch's head

docker:
  - image: cimg/node:16.20.2

steps:
  - run:
    name: Install Aikido Security CI API client
    command: npm install -g @aikidosec/ci-api-client
  - run:
    name: Scan using Aikdo's Security CI API client for this commit
    command: aikido-api-client scan <<parameters.repository_id>> <<parameters.base_commit_sha>> <<parameters.head_commit_sha>> --apikey <<parameters.aikido_api_key>>