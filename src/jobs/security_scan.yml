description: |
  Perform a security scan using Aikido Security's CI API client.
  The environment variables AIKIDO_API_KEY & AIKIDO_REPOSITORY_ID must be set for this scan to work

parameters:
  base_branch:
    type: string
    default: main
    description: Commit sha where the current branch is based on
  head_commit_sha:
    type: string
    description: Commit sha of the current branch's head

docker:
  - image: cimg/node:16.20.2

steps:
  - run:
      name: Install Aikido Security CI API client
      command: <<include(scripts/install.sh)>>
  - run:
      name: Scan using Aikdo's Security CI API client for this commit
      environment:
        BASE_BRANCH: <<parameters.base_branch>>
        HEAD_COMMIT_SHA: <<parameters.head_commit_sha>>
      command: <<include(scripts/security_scan.sh)>>
